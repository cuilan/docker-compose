services:
  homepage:
    image: ghcr.io/gethomepage/homepage:latest
    container_name: homepage
    restart: unless-stopped
    # 使用非 root 用户运行（提升安全性）
    user: '1000:1000'
    # 只读文件系统（提升安全性）
    read_only: true
    # 临时文件系统挂载点（需要写入的临时目录）
    tmpfs:
      - /tmp
      - /var/tmp
    # 安全选项
    security_opt:
      # 禁止获取新权限（防止权限提升攻击）
      - no-new-privileges:true
    # 删除所有 capabilities，然后只添加必要的
    cap_drop:
      - ALL
    # 如果需要特定 capabilities，可以在这里添加
    # cap_add:
    #   - NET_BIND_SERVICE
    ports:
      - '3000:3000'
    volumes:
      # 配置文件目录（需要读写权限，支持通过 UI 修改配置）
      - ./config:/app/config
      # 图标目录（只读）
      - ./icons:/app/public/icons:ro
      # 壁纸目录（只读）
      - ./images:/app/public/images:ro
      #- /var/run/docker.sock:/var/run/docker.sock:ro
    environment:
      - HOMEPAGE_ALLOWED_HOSTS=*
      - PUID=1000
      - PGID=1000
      - UMASK=022
    # 资源限制
    # 在标准 docker-compose v5.0.0 中，使用以下语法设置资源限制（虽然已标记为弃用，但仍可用）
    mem_limit: 512m
    mem_reservation: 128m
    cpus: '1.0'
    # 健康检查
    healthcheck:
      test: ['CMD-SHELL', 'wget --no-verbose --tries=1 --spider http://localhost:3000']
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - homepage

networks:
  homepage:
    name: homepage
    driver: bridge
